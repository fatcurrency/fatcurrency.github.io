<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown ç¼–è¾‘å™¨</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/11.1.1/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 5px;
        }

        .container {
            max-width: 100%;
            margin: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 10px);
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 3px;
        }

        .toolbar {
            background: #f5f5f5;
            padding: 8px 12px;
            border-bottom: 1px solid #ddd;
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            align-items: center;
        }

        .toolbar button {
            padding: 6px 12px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .toolbar button:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .toolbar button.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .toolbar input[type="color"] {
            width: 40px;
            height: 38px;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            padding: 2px;
        }

        .toolbar input[type="text"] {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .separator {
            width: 1px;
            height: 25px;
            background: #ddd;
        }

        .content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .editor-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-right: 2px solid #e0e0e0;
        }

        .preview-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .section-header {
            background: #fafafa;
            padding: 6px 12px;
            font-weight: bold;
            color: #333;
            border-bottom: 1px solid #ddd;
            font-size: 13px;
        }

        #editor {
            flex: 1;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: none;
            border: none;
            outline: none;
            background: white;
            color: #333;
        }

        #preview {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
            background: white;
            line-height: 1.8;
        }

        /* Markdown æ ·å¼ */
        #preview h1, #preview h2, #preview h3, #preview h4, #preview h5, #preview h6 {
            color: #333;
            margin: 20px 0 10px 0;
            line-height: 1.4;
        }

        #preview h1 {
            font-size: 32px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        #preview h2 {
            font-size: 26px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 8px;
        }

        #preview h3 {
            font-size: 22px;
        }

        #preview h4 {
            font-size: 18px;
        }

        #preview h5 {
            font-size: 16px;
        }

        #preview h6 {
            font-size: 14px;
            color: #666;
        }

        #preview p {
            margin: 10px 0;
            color: #555;
        }

        #preview a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        #preview a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        #preview strong {
            font-weight: bold;
            color: #333;
        }

        #preview em {
            font-style: italic;
            color: #666;
        }

        #preview code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #d63384;
        }

        #preview pre {
            background: #282c34;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
        }

        #preview pre code {
            background: none;
            padding: 0;
            color: #abb2bf;
        }

        #preview ul, #preview ol {
            margin: 15px 0;
            padding-left: 30px;
        }

        #preview li {
            margin: 8px 0;
            color: #555;
        }

        #preview blockquote {
            border-left: 4px solid #667eea;
            padding-left: 15px;
            margin: 15px 0;
            color: #666;
            background: #f9f9f9;
            padding: 10px 15px;
            border-radius: 4px;
        }

        #preview table {
            border-collapse: collapse;
            width: 100%;
            margin: 15px 0;
        }

        #preview table th, #preview table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        #preview table th {
            background: #667eea;
            color: white;
            font-weight: bold;
        }

        #preview table tr:nth-child(even) {
            background: #f9f9f9;
        }

        .hljs {
            background: #282c34 !important;
            color: #abb2bf !important;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }

            .editor-section {
                border-right: none;
                border-bottom: 2px solid #e0e0e0;
            }

            .toolbar {
                gap: 5px;
            }

            .toolbar button {
                padding: 6px 10px;
                font-size: 12px;
            }

            #preview, #editor {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ Markdown ç¼–è¾‘å™¨</h1>
            <p>å®æ—¶é¢„è§ˆ â€¢ ä»£ç é«˜äº® â€¢ å¯Œæ–‡æœ¬ç¼–è¾‘</p>
        </div>

        <div class="toolbar">
            <button onclick="insertMarkdown('# ', '\n')">ğŸ“Œ æ ‡é¢˜ H1</button>
            <button onclick="insertMarkdown('## ', '\n')">ğŸ“Œ æ ‡é¢˜ H2</button>
            <button onclick="insertMarkdown('### ', '\n')">ğŸ“Œ æ ‡é¢˜ H3</button>
            <div class="separator"></div>
            
            <button onclick="insertMarkdown('**', '**')">
                <strong>B</strong> åŠ ç²—
            </button>
            <button onclick="insertMarkdown('*', '*')">
                <em>I</em> æ–œä½“
            </button>
            <button onclick="insertMarkdown('~~', '~~')">
                <s>S</s> åˆ é™¤çº¿
            </button>
            <div class="separator"></div>

            <button onclick="insertMarkdown('[', '](url)')">ğŸ”— é“¾æ¥</button>
            <button onclick="insertMarkdown('![', '](url)')">ğŸ–¼ï¸ å›¾ç‰‡</button>
            <button onclick="insertMarkdown('`', '`')">ğŸ’» ä»£ç </button>
            <button onclick="insertMarkdown('```\n', '\n```')">ğŸ“¦ ä»£ç å—</button>
            <div class="separator"></div>

            <button onclick="insertMarkdown('> ', '\n')">ğŸ’¬ å¼•ç”¨</button>
            <button onclick="insertMarkdown('- ', '\n')">ğŸ“‹ åˆ—è¡¨</button>
            <button onclick="insertMarkdown('1. ', '\n')">ğŸ“Š æœ‰åºåˆ—è¡¨</button>
            <div class="separator"></div>

            <label>ğŸ¨ æ–‡å­—é¢œè‰²: </label>
            <input type="color" id="textColor" value="#000000">
            <button onclick="changeTextColor()">åº”ç”¨é¢œè‰²</button>
            <div class="separator"></div>

            <button onclick="insertMarkdown('| ', ' | ')">ğŸ“ è¡¨æ ¼</button>
            <button onclick="clearEditor()" style="background: #ff6b6b; color: white; border-color: #ff6b6b;">ğŸ—‘ï¸ æ¸…é™¤</button>
        </div>

        <div class="content">
            <div class="editor-section">
                <div class="section-header">ç¼–è¾‘åŒº</div>
                <textarea id="editor" placeholder="åœ¨è¿™é‡Œè¾“å…¥ Markdown å†…å®¹...
æ”¯æŒçš„åŠŸèƒ½ï¼š
1. **åŠ ç²—æ–‡æœ¬** - ä½¿ç”¨ **æ–‡æœ¬**
2. *æ–œä½“æ–‡æœ¬* - ä½¿ç”¨ *æ–‡æœ¬*
3. ~~åˆ é™¤çº¿~~ - ä½¿ç”¨ ~~æ–‡æœ¬~~
4. [é“¾æ¥](https://example.com)
5. ä»£ç å— - ä½¿ç”¨ ```è¯­è¨€
6. > å¼•ç”¨å—
7. - åˆ—è¡¨é¡¹
8. è¡¨æ ¼ç­‰...

ç¤ºä¾‹ï¼š

# æ ‡é¢˜
## å‰¯æ ‡é¢˜

è¿™æ˜¯ä¸€ä¸ª**åŠ ç²—**çš„æ–‡æœ¬ã€‚

```javascript
console.log('Hello World');
```

> è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨å—
"></textarea>
            </div>

            <div class="preview-section">
                <div class="section-header">é¢„è§ˆåŒº</div>
                <div id="preview"></div>
            </div>
        </div>
    </div>

    <script>
        // é…ç½® marked
        marked.setOptions({
            breaks: true,
            gfm: true
        });

        const editor = document.getElementById('editor');
        const preview = document.getElementById('preview');

        // å®æ—¶æ›´æ–°é¢„è§ˆ
        editor.addEventListener('input', updatePreview);
        
        // åˆå§‹åŒ–é¢„è§ˆ
        updatePreview();

        function updatePreview() {
            try {
                // ä¿å­˜å½“å‰æ»šåŠ¨ä½ç½®
                const scrollTop = preview.scrollTop;
                const scrollLeft = preview.scrollLeft;
                
                const markdown = editor.value;
                let html = marked.parse(markdown);
                
                // é«˜äº®ä»£ç å—
                html = html.replace(/<pre><code class="language-(\w+)">([\s\S]*?)<\/code><\/pre>/g, (match, lang, code) => {
                    try {
                        const highlighted = hljs.highlight(code.trim(), { language: lang }).value;
                        return `<pre><code class="language-${lang}">${highlighted}</code></pre>`;
                    } catch (e) {
                        return match;
                    }
                });

                // å¤„ç†ä¸å¸¦è¯­è¨€æ ‡è¯†çš„ä»£ç å—
                html = html.replace(/<pre><code>([\s\S]*?)<\/code><\/pre>/g, (match, code) => {
                    try {
                        const highlighted = hljs.highlightAuto(code.trim()).value;
                        return `<pre><code>${highlighted}</code></pre>`;
                    } catch (e) {
                        return match;
                    }
                });

                preview.innerHTML = html;
                
                // æ¢å¤æ»šåŠ¨ä½ç½®
                preview.scrollTop = scrollTop;
                preview.scrollLeft = scrollLeft;
            } catch (error) {
                preview.innerHTML = '<p style="color: red;">æ¸²æŸ“é”™è¯¯: ' + error.message + '</p>';
            }
        }

        // æ’å…¥ Markdown è¯­æ³•
        function insertMarkdown(before, after) {
            // ä¿å­˜ç¼–è¾‘å™¨çš„æ»šåŠ¨ä½ç½®
            const editorScrollTop = editor.scrollTop;
            const editorScrollLeft = editor.scrollLeft;
            
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const text = editor.value;
            const selectedText = text.substring(start, end) || 'æ–‡æœ¬';
            
            const newText = text.substring(0, start) + before + selectedText + after + text.substring(end);
            editor.value = newText;
            
            editor.focus();
            editor.selectionStart = start + before.length;
            editor.selectionEnd = start + before.length + selectedText.length;
            
            updatePreview();
            
            // æ¢å¤ç¼–è¾‘å™¨çš„æ»šåŠ¨ä½ç½®
            editor.scrollTop = editorScrollTop;
            editor.scrollLeft = editorScrollLeft;
        }

        // æ”¹å˜æ–‡å­—é¢œè‰²
        function changeTextColor() {
            // ä¿å­˜ç¼–è¾‘å™¨çš„æ»šåŠ¨ä½ç½®
            const editorScrollTop = editor.scrollTop;
            const editorScrollLeft = editor.scrollLeft;
            
            const color = document.getElementById('textColor').value;
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            
            if (start === end) {
                alert('è¯·å…ˆé€‰æ‹©è¦æ”¹å˜é¢œè‰²çš„æ–‡æœ¬');
                return;
            }
            
            const text = editor.value;
            const selectedText = text.substring(start, end);
            const coloredMarkdown = `<span style="color: ${color}">${selectedText}</span>`;
            
            const newText = text.substring(0, start) + coloredMarkdown + text.substring(end);
            editor.value = newText;
            
            editor.focus();
            updatePreview();
            
            // æ¢å¤ç¼–è¾‘å™¨çš„æ»šåŠ¨ä½ç½®
            editor.scrollTop = editorScrollTop;
            editor.scrollLeft = editorScrollLeft;
        }

        // æ¸…é™¤ç¼–è¾‘å™¨
        function clearEditor() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å†…å®¹å—ï¼Ÿ')) {
                editor.value = '';
                updatePreview();
            }
        }

        // æ”¯æŒ Tab é”®ç¼©è¿›
        editor.addEventListener('keydown', function(e) {
            if (e.key === 'Tab') {
                e.preventDefault();
                
                // ä¿å­˜ç¼–è¾‘å™¨çš„æ»šåŠ¨ä½ç½®
                const editorScrollTop = this.scrollTop;
                const editorScrollLeft = this.scrollLeft;
                
                const start = this.selectionStart;
                const end = this.selectionEnd;
                const text = this.value;
                
                this.value = text.substring(0, start) + '\t' + text.substring(end);
                this.selectionStart = this.selectionEnd = start + 1;
                updatePreview();
                
                // æ¢å¤ç¼–è¾‘å™¨çš„æ»šåŠ¨ä½ç½®
                this.scrollTop = editorScrollTop;
                this.scrollLeft = editorScrollLeft;
            }
        });

        // æ»šåŠ¨åŒæ­¥åŠŸèƒ½
        let isEditorScrolling = false;
        let isPreviewScrolling = false;

        // ç¼–è¾‘åŒºæ»šåŠ¨æ—¶åŒæ­¥é¢„è§ˆåŒº
        editor.addEventListener('scroll', function() {
            if (isPreviewScrolling) {
                isPreviewScrolling = false;
                return;
            }
            
            isEditorScrolling = true;
            
            const scrollPercentage = this.scrollTop / (this.scrollHeight - this.clientHeight);
            const previewScrollTop = scrollPercentage * (preview.scrollHeight - preview.clientHeight);
            
            preview.scrollTop = previewScrollTop;
            
            setTimeout(() => {
                isEditorScrolling = false;
            }, 100);
        });

        // é¢„è§ˆåŒºæ»šåŠ¨æ—¶åŒæ­¥ç¼–è¾‘åŒº
        preview.addEventListener('scroll', function() {
            if (isEditorScrolling) {
                isEditorScrolling = false;
                return;
            }
            
            isPreviewScrolling = true;
            
            const scrollPercentage = this.scrollTop / (this.scrollHeight - this.clientHeight);
            const editorScrollTop = scrollPercentage * (editor.scrollHeight - editor.clientHeight);
            
            editor.scrollTop = editorScrollTop;
            
            setTimeout(() => {
                isPreviewScrolling = false;
            }, 100);
        });
    </script>
</body>
</html>