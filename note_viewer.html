<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>笔记查看器</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
            min-height: 80vh;
        }
        .back-link {
            display: inline-block;
            margin-bottom: 25px;
            padding: 8px 16px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 20px;
            font-size: 14px;
            transition: background 0.3s;
        }
        .back-link:hover {
            background: #5a6fd7;
        }
        .markdown-content h1 {
            font-size: 2em;
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .markdown-content h2 {
            font-size: 1.6em;
            margin: 20px 0 12px;
            color: #34495e;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 8px;
        }
        .markdown-content h3 {
            font-size: 1.3em;
            margin: 15px 0 10px;
            color: #667eea;
        }
        .markdown-content p { margin-bottom: 12px; line-height: 1.8; }
        .markdown-content img { max-width: 100%; height: auto; display: block; margin: 12px auto; border-radius: 6px; }
        .markdown-content ul, .markdown-content ol { margin: 12px 0; padding-left: 30px; }
        .markdown-content li { margin-bottom: 6px; }
        .markdown-content code { background: #f5f5f5; padding: 2px 6px; border-radius: 3px; font-family: 'Courier New', monospace; color: #d63384; }
        .markdown-content pre { background: #282c34; padding: 15px; border-radius: 6px; overflow-x: auto; margin: 15px 0; }
        .markdown-content pre code { background: none; padding: 0; color: #abb2bf; }
        .markdown-content blockquote { border-left: 4px solid #667eea; padding-left: 15px; margin: 15px 0; color: #666; background: #f9f9f9; padding: 10px 15px; border-radius: 4px; }
        .markdown-content table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        .markdown-content th, .markdown-content td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        .markdown-content th { background: #f5f5f5; font-weight: bold; }
        .markdown-content a { color: #667eea; text-decoration: none; transition: color 0.3s; }
        .markdown-content a:hover { color: #764ba2; text-decoration: underline; }
        @media (max-width: 768px) {
            body { padding: 10px; }
            .container { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="container" id="content-container">
        <a href="fleeting_musings.html" class="back-link">← 返回列表</a>
        <div class="markdown-content" id="markdown-content">
            <p>正在加载笔记...</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 配置 marked
            marked.setOptions({
                breaks: true,
                gfm: true
            });

            const urlParams = new URLSearchParams(window.location.search);
            const noteFile = urlParams.get('note');

            if (noteFile) {
                loadNote(noteFile);
            } else {
                displayError('未指定笔记文件。');
            }
        });

        async function loadNote(filename) {
            try {
                const response = await fetch(`mynote/${filename}`);
                if (!response.ok) {
                    throw new Error(`文件加载失败 (状态: ${response.status})`);
                }
                const markdown = await response.text();
                
                // 设置页面标题
                document.title = filename.replace(/.md$/, '').replace(/-/g, ' ');

                // 渲染Markdown
                let html = marked.parse(markdown);
                
                // 高亮代码块
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;
                tempDiv.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightElement(block);
                });
                
                document.getElementById('markdown-content').innerHTML = tempDiv.innerHTML;

            } catch (error) {
                console.error('加载笔记失败:', error);
                displayError(error.message);
            }
        }

        function displayError(message) {
            document.getElementById('markdown-content').innerHTML = 
                `<p style="color: red; text-align: center;">加载失败：${message}</p>`;
        }
    </script>
</body>
</html>
